/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  PropertySelectionModal: () => PropertySelectionModal,
  default: () => LiveVariable
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");

// utils.ts
var getValueByPath = (obj, path) => {
  const keys = path.split(/\.|\[|\]/).filter(Boolean);
  return keys.reduce((acc, key) => {
    if (acc && typeof acc === "object" && acc.hasOwnProperty(key)) {
      return acc[key];
    }
    return void 0;
  }, obj);
};
var getAllNestedKeyValuePairs = (obj) => {
  const result = [];
  function recurse(currentObj, currentPath) {
    if (currentPath) {
      result.push([currentPath, currentObj]);
    }
    if (typeof currentObj === "object" && currentObj !== null) {
      if (Array.isArray(currentObj)) {
        currentObj.forEach((item, index) => {
          recurse(item, `${currentPath}[${index}]`);
        });
      } else {
        for (const key in currentObj) {
          if (currentObj.hasOwnProperty(key)) {
            recurse(
              currentObj[key],
              currentPath ? `${currentPath}.${key}` : key
            );
          }
        }
      }
    }
  }
  recurse(obj, "");
  return result;
};
var stringifyIfObj = (obj) => {
  if (typeof obj === "object") {
    return JSON.stringify(obj);
  }
  return String(obj);
};

// main.ts
var LiveVariable = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    this.propertyChanged = (currentProperties, newProperties) => {
      for (const [newPropKey, newPropVal] of Object.entries(
        newProperties != null ? newProperties : {}
      )) {
        const currentPropVal = currentProperties == null ? void 0 : currentProperties[newPropKey];
        if (JSON.stringify(currentPropVal) !== JSON.stringify(newPropVal)) {
          return true;
        }
      }
      return false;
    };
  }
  async onload() {
    let fileProperties;
    await this.loadSettings();
    this.app.workspace.on("active-leaf-change", (leaf) => {
      var _a;
      const file = this.app.workspace.getActiveFile();
      if (file) {
        fileProperties = (_a = this.app.metadataCache.getFileCache(file)) == null ? void 0 : _a.frontmatter;
        this.renderVariables(file);
      }
    });
    this.addCommand({
      id: "insert-local-variable",
      name: "Insert local variable",
      editorCallback: (editor, view) => {
        new PropertySelectionModal(
          this.app,
          view,
          false,
          (property) => {
            editor.replaceSelection(
              `<span id="${property.key}"/>${property.value}<span type="end"/>`
            );
            new import_obsidian.Notice(`Variable ${property.key} inserted`);
          }
        ).open();
      }
    });
    this.addCommand({
      id: "insert-global-variable",
      name: "Insert variable from another note",
      editorCallback: (editor, view) => {
        new PropertySelectionModal(this.app, view, true, (property) => {
          editor.replaceSelection(
            `<span id="${property.key}"/>${property.value}<span type="end"/>`
          );
          new import_obsidian.Notice(`Variable ${property.key} inserted`);
        }).open();
      }
    });
    this.registerEvent(
      this.app.metadataCache.on("changed", (path, _, cache) => {
        const frontmatterProperties = cache.frontmatter;
        if (!fileProperties) {
          fileProperties = frontmatterProperties;
          return;
        }
        const propertyChanged = this.propertyChanged(
          fileProperties,
          frontmatterProperties
        );
        if (propertyChanged) {
          const file = this.app.vault.getFileByPath(path.path);
          if (file) {
            this.renderVariables(file);
          }
          fileProperties = frontmatterProperties;
        }
      })
    );
  }
  renderVariables(file) {
    const re = new RegExp(
      String.raw`<span id="(.+?)"/>.+?<span type="end"/>`,
      "g"
    );
    this.app.vault.process(file, (data) => {
      [...data.matchAll(re)].forEach((match) => {
        var _a;
        const key = match[1];
        const lastSlashIndex = key.lastIndexOf("/");
        let variableId;
        let variableFile;
        if (lastSlashIndex === -1) {
          variableFile = file;
          variableId = key;
        } else {
          const filePath = key.substring(0, lastSlashIndex);
          variableId = key.substring(lastSlashIndex + 1);
          variableFile = this.app.vault.getFileByPath(filePath);
        }
        if (variableFile) {
          const value = getValueByPath(
            (_a = this.app.metadataCache.getFileCache(variableFile)) == null ? void 0 : _a.frontmatter,
            variableId
          );
          data = data.replace(
            match[0],
            `<span id="${key}"/>${stringifyIfObj(value)}<span type="end"/>`
          );
        }
      });
      return data;
    });
  }
  onunload() {
  }
  async loadSettings() {
  }
  async saveSettings() {
  }
};
var PropertySelectionModal = class extends import_obsidian.SuggestModal {
  constructor(app, view, global, onSelect) {
    super(app);
    this.view = view;
    this.global = global;
    this.onSelect = onSelect;
  }
  getSuggestions(query) {
    if (this.global) {
      return this.getGlobalSuggestions(query);
    }
    return this.getLocalSuggestions(query);
  }
  getLocalSuggestions(query) {
    var _a, _b;
    if (this.view.file) {
      const properties = (_b = (_a = this.app.metadataCache.getFileCache(this.view.file)) == null ? void 0 : _a.frontmatter) != null ? _b : {};
      return getAllNestedKeyValuePairs(properties).filter(
        (property) => property[0].toLowerCase().includes(query.toLowerCase())
      ).map((entry) => ({
        key: entry[0],
        value: stringifyIfObj(entry[1])
      }));
    }
    return [];
  }
  getGlobalSuggestions(query) {
    const properties = Object.assign(
      {},
      ...this.app.vault.getFiles().flatMap((file) => {
        var _a;
        let props = (_a = this.app.metadataCache.getFileCache(file)) == null ? void 0 : _a.frontmatter;
        if (props) {
          props = Object.fromEntries(
            getAllNestedKeyValuePairs(props).map(([k, v]) => [
              file.path + "/" + k,
              v
            ])
          );
        }
        return props;
      })
    );
    return Object.entries(properties).filter(
      (property) => property[0].toLowerCase().includes(query.toLowerCase())
    ).map((entry) => ({ key: entry[0], value: stringifyIfObj(entry[1]) }));
  }
  renderSuggestion(property, el) {
    el.createEl("div", { text: property.key });
    el.createEl("small", { text: property.value.substring(0, 100) + (property.value.length > 100 ? "..." : "") });
  }
  onChooseSuggestion(property, evt) {
    this.onSelect(property);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJ1dGlscy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtcblx0QXBwLFxuXHRFZGl0b3IsXG5cdEZyb250TWF0dGVyQ2FjaGUsXG5cdE1hcmtkb3duVmlldyxcblx0Tm90aWNlLFxuXHRQbHVnaW4sXG5cdFN1Z2dlc3RNb2RhbCxcblx0VEZpbGUsXG59IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IGdldEFsbE5lc3RlZEtleVZhbHVlUGFpcnMsIGdldFZhbHVlQnlQYXRoLCBzdHJpbmdpZnlJZk9iaiB9IGZyb20gJ3V0aWxzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGl2ZVZhcmlhYmxlIGV4dGVuZHMgUGx1Z2luIHtcblx0cHJvcGVydHlDaGFuZ2VkID0gKFxuXHRcdGN1cnJlbnRQcm9wZXJ0aWVzOiBGcm9udE1hdHRlckNhY2hlIHwgdW5kZWZpbmVkLFxuXHRcdG5ld1Byb3BlcnRpZXM6IEZyb250TWF0dGVyQ2FjaGUgfCB1bmRlZmluZWRcblx0KSA9PiB7XG5cdFx0Zm9yIChjb25zdCBbbmV3UHJvcEtleSwgbmV3UHJvcFZhbF0gb2YgT2JqZWN0LmVudHJpZXMoXG5cdFx0XHRuZXdQcm9wZXJ0aWVzID8/IHt9XG5cdFx0KSkge1xuXHRcdFx0Y29uc3QgY3VycmVudFByb3BWYWwgPSBjdXJyZW50UHJvcGVydGllcz8uW25ld1Byb3BLZXldO1xuXHRcdFx0aWYgKEpTT04uc3RyaW5naWZ5KGN1cnJlbnRQcm9wVmFsKSAhPT0gSlNPTi5zdHJpbmdpZnkobmV3UHJvcFZhbCkpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRhc3luYyBvbmxvYWQoKSB7XG5cdFx0bGV0IGZpbGVQcm9wZXJ0aWVzOiBGcm9udE1hdHRlckNhY2hlIHwgdW5kZWZpbmVkO1xuXHRcdGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cblx0XHQvLyBpbml0aWFsaXplIHByb3BlcnRpZXNcblx0XHR0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2FjdGl2ZS1sZWFmLWNoYW5nZScsIChsZWFmKSA9PiB7XG5cdFx0XHRjb25zdCBmaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcblx0XHRcdGlmIChmaWxlKSB7XG5cdFx0XHRcdGZpbGVQcm9wZXJ0aWVzID1cblx0XHRcdFx0XHR0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKT8uZnJvbnRtYXR0ZXI7XG5cdFx0XHRcdHRoaXMucmVuZGVyVmFyaWFibGVzKGZpbGUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0dGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnaW5zZXJ0LWxvY2FsLXZhcmlhYmxlJyxcblx0XHRcdG5hbWU6ICdJbnNlcnQgbG9jYWwgdmFyaWFibGUnLFxuXHRcdFx0ZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG5cdFx0XHRcdG5ldyBQcm9wZXJ0eVNlbGVjdGlvbk1vZGFsKFxuXHRcdFx0XHRcdHRoaXMuYXBwLFxuXHRcdFx0XHRcdHZpZXcsXG5cdFx0XHRcdFx0ZmFsc2UsXG5cdFx0XHRcdFx0KHByb3BlcnR5KSA9PiB7XG5cdFx0XHRcdFx0XHRlZGl0b3IucmVwbGFjZVNlbGVjdGlvbihcblx0XHRcdFx0XHRcdFx0YDxzcGFuIGlkPVwiJHtwcm9wZXJ0eS5rZXl9XCIvPiR7cHJvcGVydHkudmFsdWV9PHNwYW4gdHlwZT1cImVuZFwiLz5gXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0bmV3IE5vdGljZShgVmFyaWFibGUgJHtwcm9wZXJ0eS5rZXl9IGluc2VydGVkYCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHQpLm9wZW4oKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6ICdpbnNlcnQtZ2xvYmFsLXZhcmlhYmxlJyxcblx0XHRcdG5hbWU6ICdJbnNlcnQgdmFyaWFibGUgZnJvbSBhbm90aGVyIG5vdGUnLFxuXHRcdFx0ZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG5cdFx0XHRcdG5ldyBQcm9wZXJ0eVNlbGVjdGlvbk1vZGFsKHRoaXMuYXBwLCB2aWV3LCB0cnVlLCAocHJvcGVydHkpID0+IHtcblx0XHRcdFx0XHRlZGl0b3IucmVwbGFjZVNlbGVjdGlvbihcblx0XHRcdFx0XHRcdGA8c3BhbiBpZD1cIiR7cHJvcGVydHkua2V5fVwiLz4ke3Byb3BlcnR5LnZhbHVlfTxzcGFuIHR5cGU9XCJlbmRcIi8+YFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0bmV3IE5vdGljZShgVmFyaWFibGUgJHtwcm9wZXJ0eS5rZXl9IGluc2VydGVkYCk7XG5cdFx0XHRcdH0pLm9wZW4oKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHR0aGlzLnJlZ2lzdGVyRXZlbnQoXG5cdFx0XHR0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKCdjaGFuZ2VkJywgKHBhdGgsIF8sIGNhY2hlKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGZyb250bWF0dGVyUHJvcGVydGllcyA9IGNhY2hlLmZyb250bWF0dGVyO1xuXHRcdFx0XHRpZiAoIWZpbGVQcm9wZXJ0aWVzKSB7XG5cdFx0XHRcdFx0ZmlsZVByb3BlcnRpZXMgPSBmcm9udG1hdHRlclByb3BlcnRpZXM7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNvbnN0IHByb3BlcnR5Q2hhbmdlZCA9IHRoaXMucHJvcGVydHlDaGFuZ2VkKFxuXHRcdFx0XHRcdGZpbGVQcm9wZXJ0aWVzLFxuXHRcdFx0XHRcdGZyb250bWF0dGVyUHJvcGVydGllc1xuXHRcdFx0XHQpO1xuXHRcdFx0XHRpZiAocHJvcGVydHlDaGFuZ2VkKSB7XG5cdFx0XHRcdFx0Y29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVCeVBhdGgocGF0aC5wYXRoKTtcblx0XHRcdFx0XHRpZiAoZmlsZSkge1xuXHRcdFx0XHRcdFx0dGhpcy5yZW5kZXJWYXJpYWJsZXMoZmlsZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGZpbGVQcm9wZXJ0aWVzID0gZnJvbnRtYXR0ZXJQcm9wZXJ0aWVzO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdCk7XG5cdH1cblxuXHRyZW5kZXJWYXJpYWJsZXMoZmlsZTogVEZpbGUpIHtcblx0XHRjb25zdCByZSA9IG5ldyBSZWdFeHAoXG5cdFx0XHRTdHJpbmcucmF3YDxzcGFuIGlkPVwiKC4rPylcIi8+Lis/PHNwYW4gdHlwZT1cImVuZFwiLz5gLFxuXHRcdFx0J2cnXG5cdFx0KTtcblx0XHR0aGlzLmFwcC52YXVsdC5wcm9jZXNzKGZpbGUsIChkYXRhKSA9PiB7XG5cdFx0XHRbLi4uZGF0YS5tYXRjaEFsbChyZSldLmZvckVhY2goKG1hdGNoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGtleSA9IG1hdGNoWzFdO1xuXHRcdFx0XHRjb25zdCBsYXN0U2xhc2hJbmRleCA9IGtleS5sYXN0SW5kZXhPZignLycpO1xuXHRcdFx0XHRsZXQgdmFyaWFibGVJZDtcblx0XHRcdFx0bGV0IHZhcmlhYmxlRmlsZTtcblx0XHRcdFx0aWYgKGxhc3RTbGFzaEluZGV4ID09PSAtMSkge1xuXHRcdFx0XHRcdHZhcmlhYmxlRmlsZSA9IGZpbGU7XG5cdFx0XHRcdFx0dmFyaWFibGVJZCA9IGtleTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zdCBmaWxlUGF0aCA9IGtleS5zdWJzdHJpbmcoMCwgbGFzdFNsYXNoSW5kZXgpO1xuXHRcdFx0XHRcdHZhcmlhYmxlSWQgPSBrZXkuc3Vic3RyaW5nKGxhc3RTbGFzaEluZGV4ICsgMSk7XG5cdFx0XHRcdFx0dmFyaWFibGVGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKHZhcmlhYmxlRmlsZSkge1xuXHRcdFx0XHRcdGNvbnN0IHZhbHVlID0gZ2V0VmFsdWVCeVBhdGgoXG5cdFx0XHRcdFx0XHR0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZSh2YXJpYWJsZUZpbGUpXG5cdFx0XHRcdFx0XHRcdD8uZnJvbnRtYXR0ZXIsXG5cdFx0XHRcdFx0XHR2YXJpYWJsZUlkXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRkYXRhID0gZGF0YS5yZXBsYWNlKFxuXHRcdFx0XHRcdFx0bWF0Y2hbMF0sXG5cdFx0XHRcdFx0XHRgPHNwYW4gaWQ9XCIke2tleX1cIi8+JHtzdHJpbmdpZnlJZk9iaih2YWx1ZSl9PHNwYW4gdHlwZT1cImVuZFwiLz5gXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gZGF0YTtcblx0XHR9KTtcblx0fVxuXG5cdG9udW5sb2FkKCkge31cblxuXHRhc3luYyBsb2FkU2V0dGluZ3MoKSB7fVxuXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHt9XG59XG5cbmludGVyZmFjZSBQcm9wZXJ0eSB7XG5cdGtleTogc3RyaW5nO1xuXHR2YWx1ZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgUHJvcGVydHlTZWxlY3Rpb25Nb2RhbCBleHRlbmRzIFN1Z2dlc3RNb2RhbDxQcm9wZXJ0eT4ge1xuXHRvblNlbGVjdDogKHByb3BlcnR5OiBQcm9wZXJ0eSkgPT4gdm9pZDtcblx0dmlldzogTWFya2Rvd25WaWV3O1xuXHRnbG9iYWw6IGJvb2xlYW47XG5cblx0Y29uc3RydWN0b3IoXG5cdFx0YXBwOiBBcHAsXG5cdFx0dmlldzogTWFya2Rvd25WaWV3LFxuXHRcdGdsb2JhbDogYm9vbGVhbixcblx0XHRvblNlbGVjdDogKHByb3BlcnR5OiBQcm9wZXJ0eSkgPT4gdm9pZFxuXHQpIHtcblx0XHRzdXBlcihhcHApO1xuXHRcdHRoaXMudmlldyA9IHZpZXc7XG5cdFx0dGhpcy5nbG9iYWwgPSBnbG9iYWw7XG5cdFx0dGhpcy5vblNlbGVjdCA9IG9uU2VsZWN0O1xuXHR9XG5cblx0Z2V0U3VnZ2VzdGlvbnMocXVlcnk6IHN0cmluZyk6IFByb3BlcnR5W10ge1xuXHRcdGlmICh0aGlzLmdsb2JhbCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0R2xvYmFsU3VnZ2VzdGlvbnMocXVlcnkpO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5nZXRMb2NhbFN1Z2dlc3Rpb25zKHF1ZXJ5KTtcblx0fVxuXG5cdGdldExvY2FsU3VnZ2VzdGlvbnMocXVlcnk6IHN0cmluZyk6IFByb3BlcnR5W10ge1xuXHRcdGlmICh0aGlzLnZpZXcuZmlsZSkge1xuXHRcdFx0Y29uc3QgcHJvcGVydGllcyA9XG5cdFx0XHRcdHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKHRoaXMudmlldy5maWxlKVxuXHRcdFx0XHRcdD8uZnJvbnRtYXR0ZXIgPz8ge307XG5cdFx0XHRyZXR1cm4gZ2V0QWxsTmVzdGVkS2V5VmFsdWVQYWlycyhwcm9wZXJ0aWVzKVxuXHRcdFx0XHQuZmlsdGVyKChwcm9wZXJ0eSkgPT5cblx0XHRcdFx0XHRwcm9wZXJ0eVswXS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpXG5cdFx0XHRcdClcblx0XHRcdFx0Lm1hcCgoZW50cnkpID0+ICh7XG5cdFx0XHRcdFx0a2V5OiBlbnRyeVswXSxcblx0XHRcdFx0XHR2YWx1ZTogc3RyaW5naWZ5SWZPYmooZW50cnlbMV0pLFxuXHRcdFx0XHR9KSk7XG5cdFx0fVxuXHRcdHJldHVybiBbXTtcblx0fVxuXG5cdGdldEdsb2JhbFN1Z2dlc3Rpb25zKHF1ZXJ5OiBzdHJpbmcpOiBQcm9wZXJ0eVtdIHtcblx0XHRjb25zdCBwcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihcblx0XHRcdHt9LFxuXG5cdFx0XHQuLi50aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpLmZsYXRNYXAoKGZpbGUpID0+IHtcblx0XHRcdFx0bGV0IHByb3BzID1cblx0XHRcdFx0XHR0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKT8uZnJvbnRtYXR0ZXI7XG5cdFx0XHRcdGlmIChwcm9wcykge1xuXHRcdFx0XHRcdHByb3BzID0gT2JqZWN0LmZyb21FbnRyaWVzKFxuXHRcdFx0XHRcdFx0Z2V0QWxsTmVzdGVkS2V5VmFsdWVQYWlycyhwcm9wcykubWFwKChbaywgdl0pID0+IFtcblx0XHRcdFx0XHRcdFx0ZmlsZS5wYXRoICsgJy8nICsgayxcblx0XHRcdFx0XHRcdFx0dixcblx0XHRcdFx0XHRcdF0pXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcHJvcHM7XG5cdFx0XHR9KVxuXHRcdCk7XG5cdFx0cmV0dXJuIE9iamVjdC5lbnRyaWVzKHByb3BlcnRpZXMpXG5cdFx0XHQuZmlsdGVyKChwcm9wZXJ0eSkgPT5cblx0XHRcdFx0cHJvcGVydHlbMF0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxdWVyeS50b0xvd2VyQ2FzZSgpKVxuXHRcdFx0KVxuXHRcdFx0Lm1hcCgoZW50cnkpID0+ICh7IGtleTogZW50cnlbMF0sIHZhbHVlOiBzdHJpbmdpZnlJZk9iaihlbnRyeVsxXSl9KSk7XG5cdH1cblxuXHRyZW5kZXJTdWdnZXN0aW9uKHByb3BlcnR5OiBQcm9wZXJ0eSwgZWw6IEhUTUxFbGVtZW50KSB7XG5cdFx0ZWwuY3JlYXRlRWwoJ2RpdicsIHsgdGV4dDogcHJvcGVydHkua2V5IH0pO1xuXHRcdGVsLmNyZWF0ZUVsKCdzbWFsbCcsIHsgdGV4dDogcHJvcGVydHkudmFsdWUuc3Vic3RyaW5nKDAsIDEwMCkgKyAocHJvcGVydHkudmFsdWUubGVuZ3RoID4gMTAwID8gJy4uLicgOiAnJykgfSk7XG5cdH1cblxuXHRvbkNob29zZVN1Z2dlc3Rpb24ocHJvcGVydHk6IFByb3BlcnR5LCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG5cdFx0dGhpcy5vblNlbGVjdChwcm9wZXJ0eSk7XG5cdH1cbn1cbiIsICJleHBvcnQgY29uc3QgZ2V0VmFsdWVCeVBhdGggPSAob2JqOiBhbnksIHBhdGg6IHN0cmluZyk6IHN0cmluZyA9PiB7XG5cdC8vIFNwbGl0IHRoZSBwYXRoIGJ5IGJvdGggZG90cyBhbmQgYnJhY2tldHMsIGFuZCBmaWx0ZXIgb3V0IGVtcHR5IHBhcnRzXG5cdGNvbnN0IGtleXMgPSBwYXRoLnNwbGl0KC9cXC58XFxbfFxcXS8pLmZpbHRlcihCb29sZWFuKTtcblxuXHRyZXR1cm4ga2V5cy5yZWR1Y2UoKGFjYywga2V5KSA9PiB7XG5cdFx0aWYgKGFjYyAmJiB0eXBlb2YgYWNjID09PSAnb2JqZWN0JyAmJiBhY2MuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdFx0cmV0dXJuIGFjY1trZXldO1xuXHRcdH1cblx0XHRyZXR1cm4gdW5kZWZpbmVkOyAvLyBSZXR1cm4gdW5kZWZpbmVkIGlmIHRoZSBrZXkgZG9lc24ndCBleGlzdFxuXHR9LCBvYmopO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEFsbE5lc3RlZEtleVZhbHVlUGFpcnMgPSAob2JqOiBhbnkpOiBbc3RyaW5nLCBhbnldW10gPT4ge1xuXHRjb25zdCByZXN1bHQ6IFtzdHJpbmcsIGFueV1bXSA9IFtdO1xuXG5cdGZ1bmN0aW9uIHJlY3Vyc2UoY3VycmVudE9iajogYW55LCBjdXJyZW50UGF0aDogc3RyaW5nKTogdm9pZCB7XG5cdFx0Ly8gRXhjbHVkZSB0aGUgcm9vdCBvYmplY3QgYW5kIHB1c2ggbmVzdGVkIG9iamVjdHMsIGFycmF5cywgYW5kIGxlYXZlc1xuXHRcdGlmIChjdXJyZW50UGF0aCkge1xuXHRcdFx0cmVzdWx0LnB1c2goW2N1cnJlbnRQYXRoLCBjdXJyZW50T2JqXSk7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBjdXJyZW50T2JqID09PSAnb2JqZWN0JyAmJiBjdXJyZW50T2JqICE9PSBudWxsKSB7XG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheShjdXJyZW50T2JqKSkge1xuXHRcdFx0XHQvLyBJZiBpdCdzIGFuIGFycmF5LCBpdGVyYXRlIHRocm91Z2ggdGhlIGVsZW1lbnRzXG5cdFx0XHRcdGN1cnJlbnRPYmouZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcblx0XHRcdFx0XHRyZWN1cnNlKGl0ZW0sIGAke2N1cnJlbnRQYXRofVske2luZGV4fV1gKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBJZiBpdCdzIGFuIG9iamVjdCwgaXRlcmF0ZSB0aHJvdWdoIGl0cyBwcm9wZXJ0aWVzXG5cdFx0XHRcdGZvciAoY29uc3Qga2V5IGluIGN1cnJlbnRPYmopIHtcblx0XHRcdFx0XHRpZiAoY3VycmVudE9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG5cdFx0XHRcdFx0XHRyZWN1cnNlKFxuXHRcdFx0XHRcdFx0XHRjdXJyZW50T2JqW2tleV0sXG5cdFx0XHRcdFx0XHRcdGN1cnJlbnRQYXRoID8gYCR7Y3VycmVudFBhdGh9LiR7a2V5fWAgOiBrZXlcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmVjdXJzZShvYmosICcnKTsgLy8gU3RhcnQgcmVjdXJzaW9uIHdpdGggYW4gZW1wdHkgc3RyaW5nIHBhdGggZm9yIHRoZSByb290XG5cdHJldHVybiByZXN1bHQ7XG59O1xuXG5leHBvcnQgY29uc3Qgc3RyaW5naWZ5SWZPYmogPSAob2JqOiBhbnkpID0+IHtcblx0aWYgKHR5cGVvZiBvYmogPT09ICdvYmplY3QnKSB7XG5cdFx0cmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaik7XG5cdH1cblx0cmV0dXJuIFN0cmluZyhvYmopO1xufTtcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQVNPOzs7QUNUQSxJQUFNLGlCQUFpQixDQUFDLEtBQVUsU0FBeUI7QUFFakUsUUFBTSxPQUFPLEtBQUssTUFBTSxVQUFVLEVBQUUsT0FBTyxPQUFPO0FBRWxELFNBQU8s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
